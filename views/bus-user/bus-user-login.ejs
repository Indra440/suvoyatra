<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="keywords" content="Transfers - Private Transport and Car Hire HTML Template" />
	<meta name="description" content="Transfers - Private Transport and Car Hire HTML Template">
	<meta name="author" content="themeenergy.com">

	<title>Suvoyatra | Best Bus Booking Website In India</title>

	<link rel="stylesheet" href="css/styler.css" />
	<link rel="stylesheet" href="css/theme-pink.css" id="template-color" />
	<link rel="stylesheet" href="../../../../ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="css/jquery-ui.theme.css" />
	<link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="css/animate.css" />
	<link rel="stylesheet" href="css/icons.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href='http://fonts.googleapis.com/css?family=Raleway:400,500,600,700|Montserrat:400,700' rel='stylesheet' type='text/css'>
	<!-- <link rel="shortcut icon" href="images/favicon.ico" /> -->
	<script src="../../../../use.fontawesome.com/e808bf9397.js"></script>
	<link href="css/toaster.css" rel="stylesheet"/>

	<!-- <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" /> -->
	<style>
		/* div.searchable {
			width: 300px;
			float: left;
			margin: 0 15px;
		} */

		.searchable input {
			width: 100%;
			height: 50px;
			font-size: 18px;
			padding: 10px;
			-webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
			-moz-box-sizing: border-box; /* Firefox, other Gecko */
			box-sizing: border-box; /* Opera/IE 8+ */
			display: block;
			font-weight: 400;
			line-height: 1.6;
			color: #495057;
			background-color: #fff;
			background-clip: padding-box;
			border: 1px solid #ced4da;
			border-radius: .25rem;
			transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
			background: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;
		}

		.searchable ul {
			display: none;
			list-style-type: none;
			background-color: #fff;
			border-radius: 0 0 5px 5px;
			border: 1px solid #add8e6;
			border-top: none;
			max-height: 180px;
			margin: 0;
			overflow-y: scroll;
			overflow-x: hidden;
			padding: 0;
		}

		.searchable ul li {
			padding: 7px 9px;
			border-bottom: 1px solid #e1e1e1;
			cursor: pointer;
			color: #6e6e6e;
		}

		.searchable ul li.selected {
			background-color: #e8e8e8;
			color: #333;
		}
	</style>
</head>

<body>

	<!-- Header -->
	<header class="header" role="banner">
		<div class="wrap">
			<!-- Logo -->
			<div class="logo">
				<a href="/" title="Transfers"><img src="https://ik.imagekit.io/tz42dgwpw/llll_zPE5JoOhCB.png" class="logo_img" alt="Transfers" /></a>
			</div>
			<!-- //Logo -->

			<!-- Main Nav -->
			<nav role="navigation" class="main-nav" id="mySidenav">
				<ul>
					<li><a><a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a></a></li>
					<li class="active"><a href="/" title="">Home</a></li>
					<li><a href="/about" title="about">About Us</a></li>
					<li><a href="/faq" title="faqs">FAQs</a></li>
					<li><a href="/partner" title="Partner">Partner</a></li>
					<li><a title="user">user</a>
						<ul id="userMenu">
							<li><a href="/user-login" title="Login">Login</a></li>
							<li><a href="/account" title="My account">My account</a></li>
							<li><a href="/booking-history" title="booking-history">Booking History</a></li>
						</ul>
					</li>
					<li><a href="/contact" title="Contact">Get In Touch</a></li>
				</ul>
			</nav>
			<!-- //Main Nav -->
			<span style="font-size:30px;cursor:pointer" onclick="openNav()" class="nav_open">&#9776;</span>
		</div>
	</header>
	<!-- //Header -->

	<!-- Main -->
	<main class="main" role="main">
		<% if(message){ %>
            <div class="center alert-<%= message.type %>" id="flash-message">
                <button type="button" id= "close" class= "close" data-dismiss="alert">&times;</button>
                <strong><%= message.intro %> </strong>&nbsp;&nbsp;<%= message.message %>
            </div>
        <% } %>
		<!-- Page info -->
		<header class="site-title color">
			<div class="wrap">
				<div class="container">
					<h1>Driver/conductor Login</h1>
					<nav role="navigation" class="breadcrumbs">
						<ul>
							<li><a href="/" title="Home">Home</a></li>
							<li>users-login</li>
						</ul>
					</nav>
				</div>
			</div>
		</header>
		<!-- //Page info -->

		<div class="wrap">
			<div class="row">
				<!--- Content -->
				<div class="content one-half modal">
					<!--Login-->
					<div class="box">
						<form method="POST" action="/partnerRouter/partner-login">
							<div class="f-row">
								<div class="full-width">
									<label for="username">Select a bus</label>

									<div class="searchable">
										<input type="text" placeholder="Select bus" onkeyup="filterFunction(this,event)">
										<ul id="busname_dropdown">
											
										</ul>
									</div>

								</div>
							</div>
							<div class="f-row">
								<div class="full-width">
									<label for="username">Your Phone</label>
									<input type="text" id="username" />
								</div>
							</div>
                            <div class="f-row">
								<div class="full-width">
									<label for="username">Password</label>
									<input type="password" id="password" />
								</div>
							</div>
							<p><a href="/forget-pass"  class="forget-pass">Forget Password ?</a></p>
							<div class="f-row">
								<div class="full-width">
									<input type="button" value="Login" class="btn color medium full" id="login" />
								</div>
							</div>
						</form>
					</div>
					<!--//Login-->
				</div>
				<!--- //Content -->
			</div>
		</div>
	</main>
	<!-- //Main -->

	<!-- Footer -->
	<footer class="footer black" role="contentinfo">
		<div class="wrap">
			<div class="row">
				<!-- Column -->
				<article class="one-half">
					<h6>About us</h6>
					<p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt
						ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci
						tation nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Lorem ipsum dolor
						sit amet, consectetuer adipiscing elit, sed diam nonummy.</p>
				</article>
				<!-- //Column -->

				<!-- Column -->
				<article class="one-fourth">
					<h6>Need help?</h6>
					<p>Contact us via phone or email:</p>
					<p class="contact-data"><span class="icon icon-themeenergy_call"></span><a
							href="tel:+91 7869 4673 90">+91 7869 4673 90</a< /p>
							<p class="contact-data"><span class="icon icon-themeenergy_mail-2"></span> <a
									href="mailto:support@suvoyatra.in">support@suvoyatra.in</a></p>
				</article>
				<!-- //Column -->

				<!-- Column -->
				<article class="one-fourth">
					<h6>Follow us</h6>
					<ul class="social">
						<li><a href="#" title="facebook"><i class="fa fa-fw fa-facebook"></i></a></li>
						<li><a href="#" title="twitter"><i class="fa fa-fw fa-twitter"></i></a></li>
						<li><a href="#" title="gplus"><i class="fa fa-fw fa-instagram"></i></a></li>
					</ul>
				</article>
				<!-- //Column -->
			</div>

			<div class="copy">
				<p>Copyright 2020, suvoyatra. All rights reserved. </p>

				<nav role="navigation" class="foot-nav">
					<ul>
						<li><a href="/" title="Home">Home</a></li>
						<li><a href="about.html" title="About us">About us</a></li>
						<li><a href="partner.html" title="partner">Partner</a></li>
						<li><a href="contact.html" title="Contact us">Get In Touch</a></li>
						<li><a href="#" title="Terms of use">Terms & Conditions</a></li>
					</ul>
				</nav>
			</div>
		</div>
	</footer>
	<!-- //Footer -->

	<!-- jQuery -->
	<!-- <script src="../../../../ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> -->
	<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.uniform.min.js"></script>
    <script src="js/jquery.slicknav.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.min.js"></script>
	<!-- <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script> -->
	<script src="js/toaster.min.js"></script>
    <script src="js/scripts.js"></script>	
	<script>
		function openNav() {
			document.getElementById("mySidenav").style.width = "250px";
		}

		function closeNav() {
			document.getElementById("mySidenav").style.width = "0";
		}
	</script>
	<script src="js/styler.js"></script>
	<script>
		const basicUrl = window.location.origin;
		var cur_bus = "";
	$(document).ready(function(){
		fetchBusDetails();

		$("#login").click( async function(){
			if(!cur_bus || cur_bus == ""){
				return toastr.error("Please select a bus from the bus list");
			}
			let username = $("#username").val();
			let password = $("#password").val();
			if(!username || username == null || username == undefined || username == "" || String(username).length !=10 || isNaN(username)){
				return toastr.error("Please enter a valid phone number");
			}
			if(!username || username == null || username == undefined || username == ""){
				return toastr.error("Please provide your password");
			}

			await bususerLogin(cur_bus,username,password);

		})






		$(".searchable input").focus(function () {
			$(this).closest(".searchable").find("ul").show();
			$(this).closest(".searchable").find("ul li").show();
		});
		$(".searchable input").blur(function () {
			let that = this;
			setTimeout(function () {
				$(that).closest(".searchable").find("ul").hide();
			}, 300);
		});
		$(document).on('click', '.searchable ul li', function () {
			$(this).closest(".searchable").find("input").val($(this).text()).blur();
			console.log("value of the current bus ",$(this).attr('data-value'));
			onSelect($(this).attr('data-value'))
		});
		$(".searchable ul li").hover(function () {
			$(this).closest(".searchable").find("ul li.selected").removeClass("selected");
			$(this).addClass("selected");
		});

	})

		function fetchBusDetails(){
			$.ajax({
				url:basicUrl+'/fetch-bus-list',
				type: "GET",
				dataType: "JSON",
				success: function(result){
					if(result != false){
                    let busList = '';
                    if(result.buslist && result.buslist.length > 0){
                        result.buslist.map((cur_bus)=>{
                            // busList += '<option value="'+ cur_bus._id +'">'+cur_bus.busName+'</option>';
                            busList += '<li data-value="'+ cur_bus._id +'">'+cur_bus.busName+'</li>';
                        })
                    }
                    // console.log("Bus list is here ",busList);
                    $("#busname_dropdown").html(busList);
                }
				},
				error: function(response) {
					console.log("Its hitting here ",response);
				}
			})   
		}

		async function bususerLogin(busId,username,password){
			let data ={
				busId : busId,
				username : username,
				password : password
			}
			$.ajax({
				url:basicUrl+'/bususer/bus-user-login',
				type: "POST",
				data: data,
				dataType: "JSON",
				success: function(result){
					if(result != false){
						window.localStorage.setItem("suvoyatrausertoken", result.token);
                		window.location.href = basicUrl +'/users';
                	}
				},
				error: function(response) {
					console.log("Response ",response);
					response.responseJSON.message ? toastr.error(response.responseJSON.message) : toastr.error("Something went wrong please try again"); 
				}
			})

		}


		function filterFunction(that, event) {
			let container, input, filter, li, input_val;
			container = $(that).closest(".searchable");
			input_val = container.find("input").val().toUpperCase();

			if (["ArrowDown", "ArrowUp", "Enter"].indexOf(event.key) != -1) {
				keyControl(event, container)
			} else {
				li = container.find("ul li");
				li.each(function (i, obj) {
					if ($(this).text().toUpperCase().indexOf(input_val) > -1) {
						$(this).show();
					} else {
						$(this).hide();
					}
				});

				container.find("ul li").removeClass("selected");
				setTimeout(function () {
					container.find("ul li:visible").first().addClass("selected");
				}, 100)
			}
		}

		function keyControl(e, container) {
			if (e.key == "ArrowDown") {

				if (container.find("ul li").hasClass("selected")) {
					if (container.find("ul li:visible").index(container.find("ul li.selected")) + 1 < container.find("ul li:visible").length) {
						container.find("ul li.selected").removeClass("selected").nextAll().not('[style*="display: none"]').first().addClass("selected");
					}

				} else {
					container.find("ul li:first-child").addClass("selected");
				}

			} else if (e.key == "ArrowUp") {

				if (container.find("ul li:visible").index(container.find("ul li.selected")) > 0) {
					container.find("ul li.selected").removeClass("selected").prevAll().not('[style*="display: none"]').first().addClass("selected");
				}
			} else if (e.key == "Enter") {
				container.find("input").val(container.find("ul li.selected").text()).blur();
				onSelect(container.find("ul li.selected").attr('data-value'))
			}

			container.find("ul li.selected")[0].scrollIntoView({
				behavior: "smooth",
			});
		}

		function onSelect(val) {
			cur_bus = val;
		}
	</script>
	<!-- <script src="js/partner_login.js"></script> -->
</body>

</html>